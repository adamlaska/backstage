var S=n=>{throw TypeError(n)};var g=(n,t,e)=>t.has(n)||S("Cannot "+e);var y=(n,t,e)=>(g(n,t,"read from private field"),e?e.call(n):t.get(n)),w=(n,t,e)=>t.has(n)?S("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),R=(n,t,e,o)=>(g(n,t,"write to private field"),o?o.call(n,e):t.set(n,e),e),u=(n,t,e)=>(g(n,t,"access private method"),e);import{N as U,f as m}from"./ApiRef-DDVPwL0h.js";import{s as j,p as b,D as B}from"./ref-8pKZtiZi.js";import{c as v}from"./api-Co_hnf76.js";import{b as k}from"./appWrappers-D89t8mqo.js";const M=Symbol.for("CATALOG_FILTER_EXISTS_0e15b590c0b343a2bae3e787e84c2111"),F=["attachments","relations","status","metadata.name","metadata.namespace","metadata.uid","metadata.etag"];function T(n){const t=[];function e(o,a){if(!F.includes(o)){if(a==null||["string","number","boolean"].includes(typeof a)){t.push({key:o,value:a});return}if(typeof a=="object"){if(Array.isArray(a)){for(const i of a)if(e(o,i),typeof i=="string"){const s=`${o}.${i}`;t.some(r=>r.key.toLocaleLowerCase("en-US")===s.toLocaleLowerCase("en-US"))||t.push({key:s,value:!0})}return}for(const[i,s]of Object.entries(a))e(o?`${o}.${i}`:i,s)}}}return e("",n),t}function A(n){var e,o,a;const t=T(n);(e=n.metadata)!=null&&e.name&&t.push({key:"metadata.name",value:n.metadata.name.toLocaleLowerCase("en-US")}),(o=n.metadata)!=null&&o.namespace&&t.push({key:"metadata.namespace",value:n.metadata.namespace.toLocaleLowerCase("en-US")}),(a=n.metadata)!=null&&a.uid&&t.push({key:"metadata.uid",value:n.metadata.uid.toLocaleLowerCase("en-US")}),n.metadata.namespace||t.push({key:"metadata.namespace",value:B});for(const i of n.relations??[])t.push({key:`relations.${i.type.toLocaleLowerCase("en-US")}`,value:i.targetRef.toLocaleLowerCase("en-US")});return t}function p(n){if(!n)return()=>!0;const t=[n].flat();return e=>{const o=A(e);return t.some(a=>{for(const[i,s]of Object.entries(a)){const r=o.filter(c=>c.key===i.toLocaleLowerCase("en-US")).map(c=>{var l;return(l=c.value)==null?void 0:l.toString().toLocaleLowerCase("en-US")});if(r.length===0)return!1;if(s!==M){if(Array.isArray(s))return s.some(c=>r==null?void 0:r.includes(String(c).toLocaleLowerCase("en-US")));if(!(r!=null&&r.includes(String(s).toLocaleLowerCase("en-US"))))return!1}}return!0})}}var f,d,L;class I{constructor(t){w(this,d);w(this,f);var e;R(this,f,((e=t==null?void 0:t.entities)==null?void 0:e.slice())??[])}async getEntities(t){const e=p(t==null?void 0:t.filter);return{items:y(this,f).filter(e)}}async getEntitiesByRefs(t){const e=p(t.filter),o=u(this,d,L).call(this);return{items:t.entityRefs.map(a=>o.get(a)).map(a=>a&&e(a)?a:void 0)}}async queryEntities(t){if(t&&"cursor"in t)return{items:[],pageInfo:{},totalItems:0};const e=p(t==null?void 0:t.filter),o=y(this,f).filter(e);return{items:o,pageInfo:{},totalItems:o.length}}async getEntityAncestors(t){const e=u(this,d,L).call(this).get(t.entityRef);if(!e)throw new U(`Entity with ref ${t.entityRef} not found`);return{items:[{entity:e,parentEntityRefs:[]}],rootEntityRef:t.entityRef}}async getEntityByRef(t){return u(this,d,L).call(this).get(j(b(t)))}async removeEntityByUid(t){const e=y(this,f).findIndex(o=>o.metadata.uid===t);e!==-1&&y(this,f).splice(e,1)}async refreshEntity(t){}async getEntityFacets(t){const e=p(t.filter),o=y(this,f).filter(e);return{facets:Object.fromEntries(t.facets.map(i=>{var c;const s=new Map;for(const l of o){const E=(c=A(l).find(_=>_.key===i.toLocaleLowerCase("en-US")))==null?void 0:c.value;E&&s.set(String(E),(s.get(String(E))??0)+1)}const r=Array.from(s.entries()).map(([l,h])=>({value:l,count:h}));return[i,r]}))}}async getLocations(t){throw new m("Method not implemented.")}async getLocationById(t){throw new m("Method not implemented.")}async getLocationByRef(t){throw new m("Method not implemented.")}async addLocation(t){throw new m("Method not implemented.")}async removeLocationById(t){throw new m("Method not implemented.")}async getLocationByEntity(t){throw new m("Method not implemented.")}async validateEntity(t,e){throw new m("Method not implemented.")}}f=new WeakMap,d=new WeakSet,L=function(){return new Map(y(this,f).map(t=>[j(t),t]))};function O(n,t){return e=>{const o=t();if(e)for(const[a,i]of Object.entries(e))typeof i=="function"?o[a].mockImplementation(i):o[a]=i;return Object.assign(o,{factory:k({api:n,deps:{},factory:()=>o})})}}function C(n){return new I(n)}(n=>{n.factory=t=>k({api:v,deps:{},factory:()=>new I(t)}),n.mock=O(v,()=>({getEntities:jest.fn(),getEntitiesByRefs:jest.fn(),queryEntities:jest.fn(),getEntityAncestors:jest.fn(),getEntityByRef:jest.fn(),removeEntityByUid:jest.fn(),refreshEntity:jest.fn(),getEntityFacets:jest.fn(),getLocations:jest.fn(),getLocationById:jest.fn(),getLocationByRef:jest.fn(),addLocation:jest.fn(),removeLocationById:jest.fn(),getLocationByEntity:jest.fn(),validateEntity:jest.fn()}))})(C||(C={}));export{C as c};
